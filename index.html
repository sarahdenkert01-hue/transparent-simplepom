<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Timer</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Comfortaa', cursive, system-ui, -apple-system, sans-serif;
    }
    
    @keyframes pulse-ring {
      0% {
        transform: scale(0.95);
        opacity: 1;
      }
      50% {
        transform: scale(1.05);
        opacity: 0.7;
      }
      100% {
        transform: scale(0.95);
        opacity: 1;
      }
    }
    
    .timer-active {
      animation: pulse-ring 2s ease-in-out infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full flex items-center justify-center p-4 overflow-auto">
   <div class="text-center max-w-xs w-full">
    <!-- Timer Title -->
    <h1 id="timer-title" class="text-xs font-bold mb-1 text-white">Focus Session</h1>
    
    <!-- Circular Timer Display -->
    <div class="relative inline-block mb-1">
     <svg class="transform -rotate-90" width="80" height="80">
      <circle cx="40" cy="40" r="34" stroke="transparent" stroke-width="3" fill="none" />
      <circle id="progress-circle" cx="40" cy="40" r="34" stroke="#ffffff" stroke-width="3" fill="none" class="transition-all duration-300" stroke-dasharray="213.6" stroke-dashoffset="0" stroke-linecap="round" />
     </svg>
     
     <!-- Time Display -->
     <div class="absolute inset-0 flex items-center justify-center">
      <div class="text-center">
       <div id="time-display" class="text-sm font-bold text-white">25:00</div>
       <div id="status-text" class="text-white" style="opacity: 0.8; font-size: 7px;">Let's Go</div>
      </div>
     </div>
    </div>
    
    <!-- Time Preset Buttons -->
    <div class="flex gap-1 justify-center mb-1">
     <button id="preset-15" class="px-1.5 py-0.5 rounded transition-colors font-medium text-white" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.4); font-size: 9px;">15</button>
     <button id="preset-25" class="px-1.5 py-0.5 rounded transition-colors font-medium text-white" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 1); font-size: 9px;">25</button>
     <button id="preset-45" class="px-1.5 py-0.5 rounded transition-colors font-medium text-white" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.4); font-size: 9px;">45</button>
    </div>
    
    <!-- Control Buttons -->
    <div class="flex gap-1 justify-center">
     <button id="start-btn" class="px-2 py-0.5 rounded text-white transition-colors font-semibold shadow-lg" style="background-color: transparent; border: 1px solid white; font-size: 9px;">Start</button>
     <button id="pause-btn" class="px-2 py-0.5 rounded text-white transition-colors font-semibold shadow-lg hidden" style="background-color: transparent; border: 1px solid white; font-size: 9px;">Pause</button>
     <button id="reset-btn" class="px-2 py-0.5 rounded text-white transition-colors font-semibold" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.6); font-size: 9px;">Reset</button>
    </div>
   </div>
  </div>
  
  <script>
    const defaultConfig = {
      timer_title: "Focus Session",
      start_button_text: "Start",
      pause_button_text: "Pause",
      reset_button_text: "Reset",
      primary_color: "#ffffff",
      secondary_color: "#ffffff",
      text_color: "#ffffff",
      button_bg: "rgba(255, 255, 255, 0.2)",
      circle_bg: "rgba(255, 255, 255, 0.1)"
    };

    let timerInterval = null;
    let totalSeconds = 25 * 60;
    let remainingSeconds = totalSeconds;
    let isRunning = false;
    const circumference = 2 * Math.PI * 34;

    const timeDisplay = document.getElementById('time-display');
    const statusText = document.getElementById('status-text');
    const progressCircle = document.getElementById('progress-circle');
    const startBtn = document.getElementById('start-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const resetBtn = document.getElementById('reset-btn');
    const preset15 = document.getElementById('preset-15');
    const preset25 = document.getElementById('preset-25');
    const preset45 = document.getElementById('preset-45');

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateDisplay() {
      timeDisplay.textContent = formatTime(remainingSeconds);
      const progress = remainingSeconds / totalSeconds;
      const offset = circumference * (1 - progress);
      progressCircle.style.strokeDashoffset = offset;
    }

    function startTimer() {
      if (isRunning) return;
      isRunning = true;
      startBtn.classList.add('hidden');
      pauseBtn.classList.remove('hidden');
      statusText.textContent = 'Focus time! ðŸŽ¯';
      progressCircle.parentElement.classList.add('timer-active');
      
      timerInterval = setInterval(() => {
        if (remainingSeconds > 0) {
          remainingSeconds--;
          updateDisplay();
        } else {
          stopTimer();
          statusText.textContent = 'Time\'s up! Great work! ðŸŽ‰';
        }
      }, 1000);
    }

    function pauseTimer() {
      if (!isRunning) return;
      isRunning = false;
      clearInterval(timerInterval);
      startBtn.classList.remove('hidden');
      pauseBtn.classList.add('hidden');
      statusText.textContent = 'Paused';
      progressCircle.parentElement.classList.remove('timer-active');
    }

    function stopTimer() {
      isRunning = false;
      clearInterval(timerInterval);
      startBtn.classList.remove('hidden');
      pauseBtn.classList.add('hidden');
      progressCircle.parentElement.classList.remove('timer-active');
    }

    function resetTimer() {
      stopTimer();
      remainingSeconds = totalSeconds;
      updateDisplay();
      statusText.textContent = 'Ready to focus';
    }

    function setPreset(minutes) {
      stopTimer();
      totalSeconds = minutes * 60;
      remainingSeconds = totalSeconds;
      updateDisplay();
      statusText.textContent = 'Ready to focus';
      
      [preset15, preset25, preset45].forEach(btn => {
        btn.style.border = '1px solid rgba(255, 255, 255, 0.4)';
      });
      
      if (minutes === 15) {
        preset15.style.border = '1px solid rgba(255, 255, 255, 1)';
      } else if (minutes === 25) {
        preset25.style.border = '1px solid rgba(255, 255, 255, 1)';
      } else if (minutes === 45) {
        preset45.style.border = '1px solid rgba(255, 255, 255, 1)';
      }
    }

    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);
    preset15.addEventListener('click', () => setPreset(15));
    preset25.addEventListener('click', () => setPreset(25));
    preset45.addEventListener('click', () => setPreset(45));

    async function onConfigChange(config) {
      const timerTitle = document.getElementById('timer-title');
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = "'Comfortaa', cursive, system-ui, -apple-system, sans-serif";
      const baseSize = config.font_size || 12;
      
      timerTitle.textContent = config.timer_title || defaultConfig.timer_title;
      startBtn.textContent = config.start_button_text || defaultConfig.start_button_text;
      pauseBtn.textContent = config.pause_button_text || defaultConfig.pause_button_text;
      resetBtn.textContent = config.reset_button_text || defaultConfig.reset_button_text;
      
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const textColor = config.text_color || defaultConfig.text_color;
      
      timerTitle.style.color = textColor;
      timeDisplay.style.color = textColor;
      statusText.style.color = textColor;
      progressCircle.style.stroke = primaryColor;
      
      startBtn.style.backgroundColor = 'transparent';
      startBtn.style.border = `1px solid ${primaryColor}`;
      pauseBtn.style.backgroundColor = 'transparent';
      pauseBtn.style.border = `1px solid ${secondaryColor}`;
      resetBtn.style.backgroundColor = 'transparent';
      resetBtn.style.border = `1px solid rgba(255, 255, 255, 0.6)`;
      
      preset15.style.backgroundColor = 'transparent';
      preset25.style.backgroundColor = 'transparent';
      preset45.style.backgroundColor = 'transparent';
      
      if (customFont) {
        timerTitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
        timeDisplay.style.fontFamily = `${customFont}, ${baseFontStack}`;
        statusText.style.fontFamily = `${customFont}, ${baseFontStack}`;
        startBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
        pauseBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
        resetBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }
      
      timerTitle.style.fontSize = `${baseSize}px`;
      timeDisplay.style.fontSize = `${baseSize * 1.17}px`;
      statusText.style.fontSize = `${baseSize * 0.58}px`;
      startBtn.style.fontSize = `${baseSize * 0.75}px`;
      pauseBtn.style.fontSize = `${baseSize * 0.75}px`;
      resetBtn.style.fontSize = `${baseSize * 0.75}px`;
      preset15.style.fontSize = `${baseSize * 0.75}px`;
      preset25.style.fontSize = `${baseSize * 0.75}px`;
      preset45.style.fontSize = `${baseSize * 0.75}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || 12,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["timer_title", config.timer_title || defaultConfig.timer_title],
          ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
          ["pause_button_text", config.pause_button_text || defaultConfig.pause_button_text],
          ["reset_button_text", config.reset_button_text || defaultConfig.reset_button_text]
        ])
      });
      
      onConfigChange(window.elementSdk.config);
    }

    updateDisplay();
  </script>
 </body>
</html>
